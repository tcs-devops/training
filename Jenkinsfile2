pipeline {
         agent any
         
         tools{
                  maven 'm3'
         }
         
         stages {
                 stage('Checkout'){
                     steps{
                         checkout([$class: 'GitSCM',
                         branches: [[name: '*/master']],
                         userRemoteConfigs: [[url: 'http://github.com/jenkins-docs/simple-java-maven-app.git']]])
                     }
                 }    
                 stage('Build') {
                 steps {
                     echo 'Starting to build the App.'
                     sh 'mvn clean install'
                 }
                 }
                 stage('Test') {
                 steps {
                    sh 'mvn test'
                 }
                 }
                 stage('Lintin'){
                 steps{
                    sh 'mvn pmd:pmd'
                    sh 'mvn checkstyle:checkstyle'
                    sh 'mvn findbugs:findbugs'
                 }
                 }
                 stage('Post'){
                 steps{
                 }
                          post{
                             always{
                                    'build/test-results/test/*.xml'
                                    archiveArtifacts artifacts: '**/*.xml'
                                    archiveArtifacts artifacts: '**/*.jar'
                                    }
                             }
                 }
                 stage('Deploy') {
                 parallel { 
                            stage('Deploy start ') {
                           steps {
                                echo "Start the deploy .."
                           } 
                           }
                            stage('Deploying now') {
                            agent {
                                    any {
                                            reuseNode true
                                           }
                                    }
                            
                              steps {
                                echo "Docker Created"
                              }
                           }
                           }
                           }
                 stage('Prod') {
                     steps {
                                echo "App is Prod Ready"
                              }
                 
              }
}
}
