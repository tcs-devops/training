pipeline {
    agent any
    
    tools{
      maven 'm3'
      }
      
    stages {
    
        stage("Build") {
            steps {
                echo "Building"
                echo "Building finished"     
            }
        }
        
        
        stage("Checkout") {
            steps {
            checkout ([$class: 'GitSCM',
            branches: [[name: '*/master' ]],
            userRemoteConfigs: [[url: 'https://github.com/jenkins-docs/simple-java-maven-app.git']]])       
            }
        }
        
        
        stage("Deployment") {
            steps{
                sh 'mvn clean install'
            }
        }
        
        
        
        stage('Test') {
          
          steps{ 
                   sh 'mvn test'
          }     
      }
      
      
      stage('Static Code Aanalysis')
      { steps {
         sh 'mvn clean install pmd:pmd findbugs:findbugs checkstyle:checkstyle'
         recordIssues(tools: [checkStyle(pattern: 'target/checkstyle-result.xml'), pmdParser(pattern: 'target/pmd.xml'), findBugs(pattern: 'target/findbugsXml.xml',useRankAsPriority:true)])
         }
       }
    }    
 
 
 post{
     always {
       archiveArtifacts artifacts: 'target/**/*.jar', fingerprint: true
       archiveArtifacts artifacts: 'target/**/*.xml', fingerprint: true
       junit 'target/surefire-reports/*.xml'
       }
        
    }
}
